# List secrets keys from sops file
# Usage: list-secrets [--json] [sops_file]

JSON=false
SOPS_FILE="@secretsFile@"

for arg in "$@"; do
  if [ "$arg" == "--json" ]; then
    JSON=true
  else
    SOPS_FILE="$arg"
  fi
done

if [ ! -f "$SOPS_FILE" ]; then
  echo "Error: $SOPS_FILE not found."
  exit 1
fi

if [ "$JSON" == true ]; then
  # List keys in JSON format
  @sops@ --decrypt "$SOPS_FILE" | @yq@ --output-format json 'keys'
else
  # List keys one per line (human readable)
  # yq 'keys' outputs a yaml list:
  # - key1
  # - key2
  # We use sed to strip the leading "- "
  @sops@ --decrypt "$SOPS_FILE" | @yq@ 'keys' | sed 's/^- //'
fi